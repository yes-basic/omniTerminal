
    <!DOCTYPE HTML>
    <html>
    <head>
      <title>ESP32 WebSocket</title>
      <script src="ansi_up.min.js"></script>
      <script>
        var ws;
        var ansi_up = new AnsiUp();
        let reconnectInterval = 5000;
        function init() {
          ws = new WebSocket('ws://' + location.hostname + '/ws');
          ws.onopen = function() {
            console.log('Connected to WebSocket server');
            reconnectInterval = 5000;  // Reset reconnect delay on successful connection
          };
          ws.onmessage = function(event) {
            var terminal = document.getElementById("terminal");
            var html = ansi_up.ansi_to_html(event.data);
            terminal.innerHTML += html;
            terminal.scrollTop = terminal.scrollHeight;
          };
        
          document.getElementById("input").addEventListener("keydown", function(event) {
            if (event.key === "Enter") {
              send();
              event.preventDefault(); // Prevent the default action (form submission)
            }
          });

          ws.onclose = function(event) {
            console.log('Disconnected from WebSocket server:', event);
            setTimeout(init, reconnectInterval);
            reconnectInterval = Math.min(reconnectInterval * 2, 30000);  // Exponential backoff, max 30 seconds
          };
        }

        function send() {
          var input = document.getElementById("input").value;
          ws.send(input);
          document.getElementById("input").value = "";
        }
        window.onload = init;
      </script>
    </head>
    <body>
      <h1>ESP32 WebSocket Terminal</h1>
      <div id="terminal" style="background-color: black; color: white; padding: 10px; white-space: pre-wrap; height: 300px; overflow-y: auto;"></div>
      <input type="text" id="input" placeholder="Type a message..." style="width: 100%;">
      <button onclick="send()">Send</button>
      <h2>
        <a href="http://4.3.2.1/update">Update portal</a>
      </h2>
    </body>
    </html>
  
